---
{
    "stream": {
        "$id": "ds_locations",
        "source": "knowledgeGraph",
        "destination": "pages",
      "filter": {
        "entityTypes": [
          "ce_dotsquaresHotel"
        ]
      },
      "fields": [
        "id",
        "name",
        "slug",
        "description",
        "c_locations.name",
        "c_locations.mainPhone",
        "c_locations.slug",
        "c_locations.photoGallery",
        "c_locations.address",
        "c_locations.hours",
        "c_locations.featuredMessage",
		"c_locations.cityCoordinate",
        "c_relatedFAQs.question",
        "c_relatedFAQs.answer"
      ],
      "localization": {
          "locales": ["en"]
      }
    },
    "urlFormat": "{{slug}}"
}
---
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>{{name}}</title>
        <meta name="description" content="{{description}}">
        {{>head}}
    </head>
    <body class="bg-white text-gray-600 font-Poppins leading-normal text-base tracking-normal">
        {{>top-nav}}
        {{>navbar}}
        <section class="bg-clientbg">            
			<div class="flex flex-wrap">
				<div class="w-full xl:px-20 xl:py-16 px-10 py-10 flex flex-wrap">
                    <h2 class="text-3xl lg:text-4xl md:text-3xl font-semibold text-textblack mb-10 text-center w-full">Our {{name}}</h2>            
                 </div>    
                <div class="w-full xl:px-20 xl:py-16 px-10 py-10 flex flex-wrap">  
				<div class="flex justify-center">
					  <div class="mb-3 xl:w-96">
						<div class="input-group relative flex flex-wrap items-stretch w-full mb-4">
						  <input id="search_key" name="search_key" type="text" class="search_key form-control relative flex-auto min-w-0 block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none" placeholder="Enter ZIP Code or Address" aria-label="Enter ZIP Code or Address" aria-describedby="button-addon2">
						  <button class="btn inline-block px-6 py-2.5 bg-blue-600 text-white font-medium text-xs leading-tight uppercase rounded shadow-md hover:bg-blue-700 hover:shadow-lg focus:bg-blue-700  focus:shadow-lg focus:outline-none focus:ring-0 active:bg-blue-800 active:shadow-lg transition duration-150 ease-in-out flex items-center" type="button" id="button-addon2">
							<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="w-4" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
							  <path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path>
							</svg>
						  </button>
						</div>
					  </div>
					</div>
                    <div class="w-full  flex flex-wrap">									
						<div id="leftside" class="w-full md:w-1/4 xl:px-0 xl:py-0 px-5 py-5 overflow-y-auto " style="height:600px">						 
							{{#each c_locations}}
							<div data-name='{{name}}' data-lat={{cityCoordinate.latitude}} data-lng={{cityCoordinate.longitude}} class="list-group-item w-full divide-y-2 divide-gray-100">
							<h4 class="text-base font-medium text-textblack mb-2">{{name}}</h4>
								<p class="address text-sm font-light text-textblack leading-7 mb-2">
								    {{address.line1}},
									{{address.city}}, {{address.region}} {{address.postalCode}}, {{address.countryCode}}
								</p>
								<p class="text-base font-medium text-textblack "><a href="tel:{{mainPhone}}" class="text-primary">{{mainPhone}}</a></p>
								<p class="mb-8"><a  href="/location/{{slug}}.html">Read More</a></p>
							</div>
							{{/each}}
						</div> 
						<div class="w-full md:w-3/4 xl:px-0 xl:py-0 px-5 py-5">
							<div class="w-full xl:px-0 xl:py-0 px-5 py-5" id="map_canvas"></div>
						</div>
						
                    </div>    
                </div>    
            </div>
        
		
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>		
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZNQlSlEIkFAct5VzUtsP4dSbvOr2bE18&sensor=false&libraries=places"></script>
		
		
<script>


function load_map(Mapping, $, undefined) {
var self = this;

function Initialize() {
  
  var lat = 25.7748108;
  var lng = -80.197731;
  
  $('.list-group-item').each(function() {
		lat = $(this).data('lat');
		lng = $(this).data('lng');
  });
  
  
	  
  var myOptions = {
	  zoom: 8,
		center: new google.maps.LatLng( lat, lng ),
		mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  
  self.map = new google.maps.Map(document.getElementById("map_canvas"),myOptions);
  self.markers = [];
  self.infoWindow = new google.maps.InfoWindow();
  
  $('.list-group-item').each(function() {
	var $this = $(this);
	var pos = new google.maps.LatLng($this.data('lat'), $this.data('lng'));
	var marker = new google.maps.Marker({
					position: pos,
					map: self.map
				  });
	self.markers.push(marker);
	
	$this.click(function() {
	  self.map.panTo(pos);
	  self.infoWindow.setContent($this.data('name'));
	  self.infoWindow.open(self.map, marker);
	  $this.siblings().removeClass('active');
	  $this.addClass('active');
	});
  });
}

Initialize();
}

(load_map)(window.Mapping = window.Mapping || {}, jQuery);                                   

$(function(){
    $('.search_key').keyup(function(){
	
       /* var searchText = $(this).val();        
        $('.list-group-item').each(function(){            
            var currentLiText = $(this).text();
            showCurrentLi = currentLiText.indexOf(searchText) !== -1;            
            $(this).toggle(showCurrentLi);            
        });  
		*/
    });
	
	$("#button-addon2").click(function(){
	    
		var varData = { 
				api_key: '45ff39acf937fd79c35c911b61fd7e5f', 
				v: '20211229', 
				entityTypes: 'location'
		};
		
		var searchText =  $('.search_key').val();
		if(searchText){
						
			var jsstring = {
			   "$or":[
				  {
					 "address.line1":{
						"$startsWith":searchText
					 }
				  },
				  {
					 "address.city":{
						"$startsWith":searchText
					 }
				  },
				  {
					 "address.region":{
						"$startsWith":searchText
					 }
				  },
				  {
					 "address.countryCode":{
						"$startsWith":searchText
					 }
				  },
				  {
					 "address.postalCode":{
						"$startsWith":searchText
					 }
				  }
			   ]
			}; 
			
			/* var jsstring = {
			  "address.line1":{
				"$contains":searchText
			  }
			}; */
			
		  
		  var filterpar = JSON.stringify(jsstring);		  		 
		  var filter = encodeURI(filterpar);	
		  // alert(filter); 	  
		  var url = "https://api-sandbox.yext.com/v2/accounts/me/entities?filter="+filter;	
		  
		}else{		  
		  var url = "https://api-sandbox.yext.com/v2/accounts/me/entities";			  
		}
		
		
		
		$.ajax({
		  url: url,
		  type: "get", //send it through get method
		  data: varData,
		  success: function(result) { // alert();
			
			if(!result.errors){
				
				if(result.response.count > 0 ){
				
					var html = '';
					$.each(result.response.entities, function( index, entity ){
					
						html  += '<div data-name="'+entity.name+'" data-lat="'+entity.cityCoordinate.latitude+'" data-lng="'+entity.cityCoordinate.longitude+'" class="list-group-item w-full divide-y-2 divide-gray-100">';
						html  += '<h4 class="text-base font-medium text-textblack mb-2">'+entity.name+'</h4>';
						html  += '<p class="address text-sm font-light text-textblack leading-7 mb-2">';
						html  += entity.address.line1+', '+entity.address.city+', '+entity.address.region+', '+entity.address.postalCode+', '+entity.address.countryCode;
						html  += '</p>';
						html  += '<p class="text-base font-medium text-textblack mb-8"><a href="tel:'+entity.mainPhone+'" class="text-primary">'+entity.mainPhone+'</a></p>';
						html  += '<p class="mb-8"><a  href="/location/'+entity.meta.id+'-'+convertToSlug(entity.neighborhood)+'.html">Read More</a></p>';
						html  += '</div>';
					
						
					});
					$("#leftside").html(html);
					(load_map)(window.Mapping = window.Mapping || {}, jQuery); 

				
				}else{
					$("#leftside").html('<p class="text-base font-medium text-textblack mb-8">Location not found.</p>');
				}
				
			}else{
				$("#leftside").html('<p class="text-base font-medium text-textblack mb-8">Location not found.</p>');
			}	
			
			
		  },
		  error: function(xhr) {
			$("#leftside").html('<p class="text-base font-medium text-textblack mb-8">Location not found.</p>');
		  }
		});
	});
	
});

function initializeAutocomplete() {
  var input = document.getElementById('search_key');
  new google.maps.places.Autocomplete(input, {
    componentRestrictions: { country: ["us"] },
    fields: ["street_number"],
    types: ["address"],
  });
}

google.maps.event.addDomListener(window, 'load', initializeAutocomplete);

function convertToSlug(Text) {
  return Text.toLowerCase()
             .replace(/ /g, '-')
             .replace(/[^\w-]+/g, '');
}
   
</script>
<style>
#map_canvas {
    width: 800px;
    height: 600px;
    margin: 2em auto;
}
</style>	
		</section>
        {{#if c_relatedFAQs}}
         {{>faq-above-footer c_relatedFAQs}}
         {{/if}}
        {{>footer}}
    </body>
</html>